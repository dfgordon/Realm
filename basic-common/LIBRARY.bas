10 ON I GOTO 11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26
11 C = 50:A$ = "PHANTOM ARROW": RETURN
12 C = 75:A$ = "FIREBALL": RETURN
13 C = 75:A$ = "LIGHTNING BOLT": RETURN
14 C = 100:A$ = "RADIATION CONE": RETURN
15 C = 200:A$ = "ICE STORM": RETURN
16 C = 300:A$ = "BOMBARDMENT": RETURN
17 C = 60:A$ = "SLEEP": RETURN
18 C = 60:A$ = "STONE": RETURN
19 C = 80:A$ = "PARALYZE": RETURN
20 C = 175:A$ = "DOOM ARROW": RETURN
21 C = 250:A$ = "DISINTEGRATE": RETURN
22 C = 450:A$ = "KILL": RETURN
23 C = 50:A$ = "KNOCK": RETURN
24 C = 200:A$ = "PASSWALL": RETURN
25 C = 400:A$ = "FLY": RETURN
26 C = 100:A$ = "SHIELD": RETURN

4310  PRINT "LEARNED:";TAB(16);"SPELLS (M.U.):"
4311  PRINT "--------";TAB(16);"--------------"
4320  FOR I = 1 TO 16: GOSUB 10: PRINT LEFT$(AX$(A,I-1),14);TAB(16);: IF I=1 THEN INVERSE
4330  PRINT A$;: NORMAL: PRINT " (";C;")": NEXT
4340  RETURN

8900  REM
9300  GOSUB 9600: IF C = 0 THEN 25001
9310  TEXT : HOME : PRINT "WELCOME TO THE LIBRARY, ";NM$(A)
9311  PRINT : PRINT "ONE MOMENT WHILE I FILE THINGS...": FOR P = 0 TO EP: NEXT P
9312 P = 0: M =  FRE (0)
9313  FOR I = 0 TO 15:AX$(A,I) = "": NEXT
9314 M =  FRE (0):WT% =  INT (ZA%(A) / 1000) * 100 + 100:WT% = WT% + (WT% * (AG%(A) / 100))
9315  IF CL$(A) = "RANGER" THEN WT% = WT% / 2

9520 HOME: GOSUB 4310: I = 1
9530  VTAB 20: HTAB 1: PRINT "MAGIC UNITS: ";WT%;"- ARROWS, ENTER, ESC: ";: CALL -868: GET A$: IF A$ = CHR$(27) THEN 9700
9540  L = 0: IF A$ = CHR$(13) THEN GOSUB 10: GOTO 9560
9550  IF A$ = CHR$(8) OR A$ = CHR$(11) THEN L = -1
9551  IF A$ = CHR$(10) OR A$ = CHR$(21) THEN L = 1
9552  GOSUB 10: HTAB 16: VTAB 2+I: PRINT A$: I = I + L
9553  IF I<1 THEN I=16
9554  IF I>16 THEN I=1
9555  GOSUB 10: HTAB 16: VTAB 2+I: INVERSE: PRINT A$: NORMAL: GOTO 9530

9560 WT% = WT% - C: IF WT% < 0 THEN 9590
9570 AX$(A,P) =  LEFT$ (A$ + " ", LEN (A$)): IF P=15 OR WT%<50 THEN 25000
9580  HTAB 1: VTAB P+3: PRINT LEFT$(AX$(A,P),14);: P = P + 1: GOTO 9530

9590  PRINT : PRINT "NOT ENOUGH MAGIC UNITS! ";: GOSUB 30050: WT% = WT% + C: GOTO 9520

9600  HOME : VTAB 21: PRINT "CHARACTER TO TRANSACT (#) ";: GET A$:A =  VAL (A$) - 1: IF A<0 OR A>3 THEN 9600
9601  IF AB%(A) = 0 THEN 9600
9602  IF CL$(A) <> "WIZARD" AND CL$(A) <> "RANGER" THEN HOME : VTAB 21: PRINT "NOT A WIZARD OR RANGER. ";: GOSUB 30050: C = 0: RETURN
9604 C = (10 +  INT (ZA%(A) / 1000) * 8) * (1 - AK%(A) / 100)
9605  PRINT: PRINT "LIBRARY COSTS ";INT(C);" GOLD, OK? (Y/N) ";: GET A$: IF A$ <> "Y" THEN C = 0: RETURN
9610 AD% = AD% - C
9620  IF AD% < 0 THEN AD% = AD% + C: HOME: VTAB 21: PRINT "YOU DON'T HAVE THE GOLD! ";: GOSUB 30050: C = 0: RETURN
9630  RETURN

9700  HTAB 1: VTAB 21: PRINT "(R)ESET OR (L)EAVE WITH UNSPENT M.U.: ";: GET A$
9710  IF A$ = "R" THEN 9310
9720  IF A$ = "L" THEN 25000
9730  GOTO 9700

25000  DR%(A,2) = 0: DX$(A) = AX$(A,0): IF DX$(A) = "" THEN DX$(A) = AX$(A,16): DR%(A,2) = 16
25001  L=1: POKE -16304,0: POKE 16384,0: POKE 103,1: POKE 104,64: GOTO 25000

30050  POKE 6,50: POKE 7,25: POKE 8,1: POKE 9,1: POKE 30,1: CALL 852: GET A$: RETURN
